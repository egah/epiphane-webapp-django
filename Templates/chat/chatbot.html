<html>
  <!--This is my chatbot interface page. can you read the Templates/chat.html layout create for me a similar frontend that fit a whole page in chatbot.html. To do so you need static/css/style.css and static/js/script.js-->
  <head>
    <meta charset="utf-8">
    <title>Chatbot in JavaScript | CodingNepal</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Google Fonts Link For Icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,1,0" />
    <script src="{% static 'js/script.js' %}" defer></script>
  </head>
  <body id="bodyy">
  <!--This is my chatbot interface page. can you read the Templates/chat.html layout create for me a similar frontend taht fit a whole page in chatbot.html. To do so you need static/css/style.css and static/js/script.js-->
    <button class="chatbot-toggler">
      <span class="material-symbols-rounded">mode_comment</span>
      <span class="material-symbols-outlined">close</span>
    </button>
    <div class="chatbot">
      <header>
        <h1>epiphane-ai</h1>
        <span class="close-btn material-symbols-outlined">close</span>
      </header>
      <ul class="chatbox">
        <li class="chat incoming">
          <span class="material-symbols-outlined">smart_toy</span>
          <p>Hi there ðŸ‘‹<br>How can I help you today?</p>
        </li>
      </ul>
      <div class="chat-input">
        <textarea placeholder="Enter a message..." spellcheck="false" required></textarea>
        <span id="send-btn" class="material-symbols-rounded">send</span>
      </div>
    </div>

  </head>

  <body>
    
  </body>
    <script>
    var wss_protocol = window.location.protocol == "https:" ? "wss://" : "ws://";
    var chatSocket = new WebSocket(
        wss_protocol + window.location.host + "/ws/chat/"
    );
    var messages = []; // This array will hold the chat messages

    chatSocket.onmessage = function (e) {
        var data = JSON.parse(e.data);
        var message = data["text"];
        messages.push(message);

        var str = '<div class="space-y-2">';
        messages.forEach(function (msg) {
            str += `<p class="chat ${msg.source == "bot" ? "incoming" : "outgoing"}">
                        <div class="chat-bubble ${msg.source == "bot" ? "left" : "right"}">${msg.msg}</div>
                    </p>`;
        });
        str += "</div>";
        document.querySelector(".chat-box").innerHTML = str;
    };

    chatSocket.onclose = function (e) { // Alert the user if the WebSocket closes unexpectedly
        alert("Socket closed unexpectedly, please reload the page.");
    };

    document.querySelector("#chat-message-input").focus();
    document.querySelector("#chat-message-input").onkeyup = function (e) {
        if (e.keyCode === 13) {
            // enter, return
            document.querySelector("#send-btn").click(); // Trigger sending the message when Enter is pressed
        }
    };

    document.querySelector("#chat-message-submit").onclick = function (e) {
        var messageInputDom = document.querySelector("#chat-message-input");
        var message = messageInputDom.value;
        chatSocket.send( // Send the message to the WebSocket
            JSON.stringify({
                text: message,
            })
        );

        messageInputDom.value = "";
    };
</script>
</html>